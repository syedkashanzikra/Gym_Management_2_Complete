import{Q as B}from"./QTd.d26cec80.js";import{Q as D}from"./QTr.6cbeded8.js";import{Q as M}from"./QBanner.bf86e8e3.js";import{Q as S}from"./QPopupProxy.e4ea2ef4.js";import{_ as Y,M as z,aE as A,N as E,r as k,o as l,a as p,w as a,f as t,h as m,t as i,g as w,d as g,ag as $,e as b,F as P,l as Q,a5 as y,a4 as R,a8 as L,K as F,I as j,dE as K}from"./index.46fdd451.js";import{Q as O}from"./QItemLabel.249954d1.js";import{Q as G}from"./QPage.701dd41d.js";import{u as N}from"./class-schedule.b7d1748f.js";import"./QMenu.84416a21.js";import"./selection.e9a8e664.js";const{formatDate:J,addToDate:U}=K,I=(e=0)=>J(U(new Date,{days:e}),"YYYY-MM-DD"),W={data(){return{loading:!1,pagination:{sortBy:"date_at",otherSortBy:"start_at",descending:!1,page:1,filter:"",active:null,deleted:!1,rowsPerPage:15,rowsNumber:15,loaded:!1,date_from:I(),date_to:I(6)},rowsByDate:[]}},methods:{...z(N,["get","book"]),onRequest(e){console.func("pages/pages/users/BookablePage:methods.onRequest()",arguments);const{page:s,rowsPerPage:q,sortBy:T,descending:d}=e.pagination;this.pagination=e.pagination,this.loading=!0,this.get({...e.pagination,direction:d?"desc":"asc"}).then(({data:n})=>{const _=A.exports.groupBy(n,r=>r.day);this.rowsByDate=Object.keys(_).map(r=>({id:r,day:`${r} (${_[r][0].date_at_formated})`,rows:_[r]})),this.pagination.page=s,this.pagination.rowsPerPage=q,this.pagination.sortBy=T,this.pagination.descending=d,this.pagination.loaded=!0,this.loading=!1}).catch(n=>{this.$core.error(n,{title:this.$t("dialog.title.error")})})},async toolbarClicked(e,s){console.func("pages/users/BookablePage:methods.toolbarClicked()",arguments)},async rowClicked(e,s){if(console.func("pages/users/BookablePage:methods.rowClicked()",arguments),!!s.bookable){if(s.has_booked){this.$core.warning(this.$t("dialog.info.noSlotAvailable"));return}if(s.is_booked){this.$core.warning(this.$t("dialog.info.userAlreadyBooked"));return}s.loading=!0,this.book(s).then(()=>{s.loading=!1,s.is_booked=!0}).catch(()=>{s.loading=!1})}},onChangeDate(e){console.func("pages/users/BookablePage:methods.onChangeDate()",arguments),this.onRequest({pagination:{...this.pagination}})},getColor(e){return e.has_booked?"warning":e.bookable?"secondary":"negative"}},computed:{...E(N,["rows","columns","module","toolbar","filters"]),permissions(){return[]},hasBlocked(){return this.$app.user.has_blocked},blocked(){return this.$app.user.blocked}}},X=["innerHTML"],Z={key:0,class:"q-mt-sm"},x=["href"],ee={class:"col-xs-12"},ae=["innerHTML"],oe={key:0,class:"q-mt-sm"},te=["href"],se={key:1};function le(e,s,q,T,d,n){const _=k("base-info"),r=k("base-label"),C=k("base-table"),H=k("base-btn"),V=k("base-section");return l(),p(G,{padding:""},{default:a(()=>[t(V,{flat:"",bordered:"",title:e.$t("dateRange",{from:e.$core.formatDate(d.pagination.date_from),to:e.$core.formatDate(d.pagination.date_to)}),"no-row":""},{default:a(()=>[t(C,{module:e.module,columns:[{name:"id",label:"Day",field:"day",align:"left",sortable:!1}],rows:d.rowsByDate,toolbar:e.toolbar,filters:e.filters,loading:d.loading,pagination:d.pagination,onRequest:n.onRequest,onToolbarClicked:n.toolbarClicked,"no-data-label":e.$t("registrations.noData"),"no-permissions":"","hide-pagination":"","hide-header":""},{"top-bottom":a(()=>[n.hasBlocked?(l(),p(_,{key:0,rounded:"",class:"q-mt-md"},{default:a(()=>[m(i(e.$t("blockedInfo",{release:n.blocked.release_at})),1)]),_:1})):w("",!0)]),body:a(u=>[t(D,{"no-hover":"",class:"day-header",props:u},{default:a(()=>[(l(!0),g(P,null,$(u.cols,o=>(l(),p(B,{key:o.name,props:u},{default:a(()=>[b("span",null,i(o.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"]),t(D,{props:u},{default:a(()=>[t(B,{class:"q-pa-none",colspan:"100%"},{default:a(()=>[t(C,{columns:e.columns,rows:u.row.rows,"hide-top":"","hide-pagination":"","rows-per-page-options":[0],loaded:""},{actions:a(o=>{var f,h;return[(h=(f=o.row)==null?void 0:f.class)!=null&&h.has_description?(l(),p(Q,{key:0,icon:"fad fa-circle-info",onClick:s[0]||(s[0]=y(()=>{},["stop"])),flat:"",size:"sm",round:""},{default:a(()=>[t(S,null,{default:a(()=>[t(M,{style:{width:"350px"}},{default:a(()=>[t(r,null,{default:a(()=>[m(i(e.$t("description")),1)]),_:1}),b("span",{innerHTML:e.$core.nl2br(o.row.class.description)},null,8,X),o.row.class.urls?(l(),g("div",Z,[t(r,null,{default:a(()=>[m(i(e.$t("urls")),1)]),_:1}),(l(!0),g(P,null,$(o.row.class.urls,(c,v)=>(l(),g("div",{key:v},[b("a",{href:c.url},i(c.label||c.url),9,x)]))),128))])):w("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)):w("",!0),R(t(Q,{onClick:y(c=>n.rowClicked(o,o.row),["stop"]),size:"sm",round:"",flat:"",color:n.getColor(o.row),icon:`fas fa-calendar-circle-${o.row.is_booked?"user":"plus"}`,loading:o.row.loading},null,8,["onClick","color","icon","loading"]),[[L,o.row.bookable]])]}),_:2},1032,["columns","rows"])]),_:2},1024)]),_:2},1032,["props"])]),item:a(u=>[b("div",ee,[t(F,{class:"bg-grey-4"},{default:a(()=>[t(j,{avatar:""},{default:a(()=>[t(O,null,{default:a(()=>[m(i(u.row.day),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(D,null,{default:a(()=>[t(B,{class:"q-pa-none",colspan:"100%"},{default:a(()=>[t(C,{columns:e.columns,rows:u.row.rows,"hide-top":"","hide-pagination":"","rows-per-page-options":[0],loaded:"","has-actions":""},{"body-cell-class":a(o=>{var f,h;return[(h=(f=o.row)==null?void 0:f.class)!=null&&h.has_description?(l(),p(H,{key:0,link:"",label:o.value,onClick:s[1]||(s[1]=y(()=>{},["stop"]))},{default:a(()=>[t(S,null,{default:a(()=>[t(M,{style:{width:"350px"}},{default:a(()=>[t(r,null,{default:a(()=>[m(i(e.$t("description")),1)]),_:1}),b("span",{innerHTML:e.$core.nl2br(o.row.class.description)},null,8,ae),o.row.class.urls?(l(),g("div",oe,[t(r,null,{default:a(()=>[m(i(e.$t("urls")),1)]),_:1}),(l(!0),g(P,null,$(o.row.class.urls,(c,v)=>(l(),g("div",{key:v},[b("a",{href:c.url},i(c.label||c.url),9,te)]))),128))])):w("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label"])):(l(),g("span",se,i(o.value),1))]}),actions:a(o=>[R(t(Q,{onClick:y(f=>n.rowClicked(o,o.row),["stop"]),size:"sm",round:"",flat:"",color:n.getColor(o.row),icon:`fas fa-calendar-circle-${o.row.is_booked?"user":"plus"}`,loading:o.row.loading},null,8,["onClick","color","icon","loading"]),[[L,o.row.bookable]])]),_:2},1032,["columns","rows"])]),_:2},1024)]),_:2},1024)])]),_:1},8,["module","rows","toolbar","filters","loading","pagination","onRequest","onToolbarClicked","no-data-label"])]),_:1},8,["title"])]),_:1})}var _e=Y(W,[["render",le]]);export{_e as default};
