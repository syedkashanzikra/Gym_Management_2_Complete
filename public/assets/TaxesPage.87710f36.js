import{_ as D,r,o as S,a as P,w as n,f as o,e as m,h as p,J as T,cX as q,A as f,dz as y,M as Q,N as R,af as A,t as g,l as w,a5 as V}from"./index.46fdd451.js";import{Q as U}from"./QToolbar.72090c76.js";import{Q as v}from"./QItemLabel.249954d1.js";import{Q as H}from"./QPage.701dd41d.js";import{C as N,S as O}from"./StateSelect.8267e923.js";import"./index.becf6c0c.js";const B={components:{CountrySelect:N,StateSelect:O},props:{title:String,modelValue:{type:Object,default:()=>({})},method:Function},data(){return{tax:this.modelValue,loading:!1}},emits:["ok","hide"],methods:{async show(){console.func("components/shop/VariantDialog:methods.show()",arguments),this.tax=this.modelValue,this.$refs.dialog.show()},hide(){console.func("components/shop/VariantDialog:methods.close()",arguments),this.$refs.dialog.hide()},onDialogHide(){console.func("components/shop/VariantDialog:methods.onDialogHide()",arguments),this.$emit("hide")},onDone(){console.func("components/shop/VariantDialog:methods.onDone()",arguments),this.loading=!0,this.method(this.tax).then(({data:e})=>{this.$emit("ok",e),this.hide(),this.loading=!1}).catch(e=>{this.$core.error(e),this.loading=!1})}}},L={class:"col-xs-12 col-sm-4"},z={class:"col-xs-12 col-sm-4"},E={class:"col-xs-12 col-sm-4"},M={class:"col-xs-12 col-sm-3"},I={class:"col-xs-12 col-sm-3"},j={class:"col-xs-12 col-sm-12"};function F(e,t,i,a,s,c){const u=r("base-label"),b=r("country-select"),_=r("state-select"),h=r("base-input"),d=r("base-section"),x=r("base-dialog");return S(),P(x,{title:i.title,"body-class":"q-pa-none scroll",ref:"dialog",onHide:c.onDialogHide,onOk:c.onDone,"use-separator":"",persistent:"",loading:s.loading},{body:n(()=>[o(d,{flat:""},{default:n(()=>[m("div",L,[o(u,{required:""},{default:n(()=>[p("Country")]),_:1}),o(b,{readonly:s.tax.removeable,modelValue:s.tax.country,"onUpdate:modelValue":t[0]||(t[0]=l=>s.tax.country=l),style:{width:"100%"},onComplete:t[1]||(t[1]=l=>s.tax.code=l.iso2)},null,8,["readonly","modelValue"])]),m("div",z,[o(u,{required:""},{default:n(()=>[p("State")]),_:1}),o(_,{readonly:s.tax.removeable,modelValue:s.tax.state,"onUpdate:modelValue":t[2]||(t[2]=l=>s.tax.state=l),country:s.tax.country,"option-value":"state_code",style:{width:"100%"}},null,8,["readonly","modelValue","country"])]),m("div",E,[o(u,{required:""},{default:n(()=>[p("Label")]),_:1}),o(h,{debounce:"500",modelValue:s.tax.label,"onUpdate:modelValue":t[3]||(t[3]=l=>s.tax.label=l),style:{width:"100%"}},null,8,["modelValue"])]),m("div",M,[o(u,{required:""},{default:n(()=>[p("Rate")]),_:1}),o(h,{modelValue:s.tax.rate,"onUpdate:modelValue":t[4]||(t[4]=l=>s.tax.rate=l),type:"number",min:"0",debounce:"500",style:{width:"100%"}},null,8,["modelValue"])]),m("div",I,[o(u,null,{default:n(()=>[p("Priority")]),_:1}),o(h,{debounce:"500",modelValue:s.tax.priority,"onUpdate:modelValue":t[5]||(t[5]=l=>s.tax.priority=l),type:"number",min:"0"},null,8,["modelValue"])]),m("div",j,[o(T,{dense:"",modelValue:s.tax.compounded,"onUpdate:modelValue":t[6]||(t[6]=l=>s.tax.compounded=l),color:"green",label:"Compounded"},null,8,["modelValue"])])]),_:1})]),_:1},8,["title","onHide","onOk","loading"])}var k=D(B,[["render",F]]);const C=q("taxes",{getters:{columns:e=>[{name:"country",align:"left",label:"Country",field:"country",style:"width: 100px;",sortable:!0},{name:"state",align:"left",label:"State",field:"state",style:"width: 50px;",sortable:!0},{name:"label",align:"left",label:"Label",field:"label",style:"width: 100px;",sortable:!0},{name:"rate",align:"center",label:"Rate %",field:"rate",style:"width: 100px;",sortable:!0},{name:"compounded",align:"center",label:"Compounded",field:"compounded",format:t=>t?"Yes":"No",style:"width: 50px;",sortable:!0},{name:"priority",align:"center",label:"Priority",field:"priority",style:"width: 100px;",sortable:!0},{name:"actions",align:"right",sortable:!1}]},actions:{get(e){return new Promise((t,i)=>{f.get("taxes",e).then(a=>{const s=a.map(c=>({...c,removeable:c.code==="*"}));this.setRows(s),t(s)}).catch(a=>{i(a)})})},store(e){return new Promise((t,i)=>{f.post("taxes/store",e).then(a=>{t(a)}).catch(a=>{i(a)})})},update(e){return new Promise((t,i)=>{f.put(`taxes/${e.id}`,e).then(a=>{t(a)}).catch(a=>{i(a)})})},delete(e){return new Promise((t,i)=>{f.delete(`taxes/${e}/destroy`).then(a=>{this.deleteRows({id:e}),t(a)}).catch(a=>{i(a)})})},add(){y.create({component:k,componentProps:{title:"Add tax",method:this.store,modelValue:{country:null,code:null,state:"*",label:"VAT",rate:0,compounded:!1,priority:0}}}).onOk(e=>{this.pushRows(e)})},edit({row:e,pageIndex:t}){y.create({component:k,componentProps:{title:"Update tax",method:this.update,modelValue:{...e}}}).onOk(i=>{this.editRows(i)})}}}),G={data(){return{loaded:!1}},methods:{...Q(C,["get","store","update","delete","add","edit"]),onEdit(e){console.func("components/settings/TaxesDialog:methods.onEdit()",arguments),this.edit(e)},onRemove({row:e}){console.func("components/settings/TaxesDialog:methods.onRemove()",arguments),this.$core.confirm("Are you sure you want to delete this tax?").then(()=>{this.delete(e==null?void 0:e.id)})}},computed:{...R(C,["rows","columns"])},mounted(){this.get().then(()=>{this.loaded=!0}).catch(e=>{this.$core.error(e)})}},J={class:"q-gutter-xs"};function X(e,t,i,a,s,c){const u=r("base-page-header"),b=r("base-btn"),_=r("base-table"),h=r("base-section");return S(),P(H,{padding:""},{default:n(()=>[o(u,{class:"q-mb-md",title:"Taxes and duties",hint:"Manage sales tax collection",tabs:["Locations","Taxes","Payments"],"use-route":""}),o(U,null,{default:n(()=>[o(b,{icon:"fas fa-arrow-left",link:"",label:"Go to settings",to:{name:"Settings"}}),o(A),o(b,{class:"q-mb-md",label:"Add tax",onClick:e.add},null,8,["onClick"])]),_:1}),o(h,{flat:"",bordered:"","no-row":""},{default:n(()=>[o(_,{ref:"taxes",columns:e.columns,rows:e.rows,"hide-top":"","hide-pagination":"","rows-per-page-options":[0],loaded:s.loaded,"has-actions":""},{"section-body":n(d=>[o(v,{class:"q-mb-xs"},{default:n(()=>[p(g(d.row.country)+" ("+g(d.row.state)+") ",1)]),_:2},1024),o(v,{caption:""},{default:n(()=>[p(g(d.row.label)+" - "+g(d.row.rate)+"% ",1)]),_:2},1024)]),actions:n(d=>[m("div",J,[o(w,{onClick:V(x=>c.onEdit(d),["stop"]),size:"sm",round:"",flat:"",color:"warning",icon:"fas fa-edit"},null,8,["onClick"]),o(w,{onClick:V(x=>c.onRemove(d),["stop"]),size:"sm",round:"",flat:"",color:"grey",icon:"fas fa-trash-can",disable:d.row.removeable},null,8,["onClick","disable"])])]),_:1},8,["columns","rows","loaded"])]),_:1})]),_:1})}var te=D(G,[["render",X]]);export{te as default};
