import{Q as R}from"./QTimeline.b6d0ce4e.js";import{Q as B}from"./QPage.701dd41d.js";import{_ as J,aE as c,M as x,r as l,o as n,a as p,w as d,e as a,f as o,d as m,h as _,t as h,F as g,n as O,i as Q,ag as k,g as V,aF as F}from"./index.46fdd451.js";import{S as L}from"./SkeletonSinglePage.f05b1d90.js";import{u as M}from"./task.d65cd3de.js";import{u as E}from"./staff.43951c10.js";import{T as H}from"./EnquiryStatus.73cac8d7.js";import"./QSkeleton.a3e15f44.js";import"./enquiry.aa47bedc.js";const T={media:[],status:"Pending",message:""},I={components:{SkeletonSinglePage:L,TaskStatus:H},data(){return{default:c.exports.cloneDeep(T),task:c.exports.cloneDeep(T),loaded:!1,submited:!1}},methods:{...x(M,["store","show","update","changeArchived","changeUserArchived"]),...x(E,{getStaff:"options",getUser:"show"}),onSubmit(e){console.func("pages/core/tasks/TaskPage:methods.onSubmit()",arguments),this.submited=!0,(this.creating?this.store:this.update)(this.task).then(({data:u,message:b})=>{this.submited=!1,this.$q.notify(b),this.task=u,this.default=c.exports.cloneDeep(u),this.$router.push({name:"Single Task",params:{id:u.id},query:{action:"edit",title:u.subject}})}).catch(u=>{this.submited=!1,this.$core.error(u,{title:this.$t("dialog.title.error")})})},onReset(e){console.func("pages/core/tasks/TaskPage:methods.onReset()",arguments),this.loaded=!1,this.$nextTick(()=>{this.task=c.exports.cloneDeep(this.default),this.loaded=!0})},onCancel(e){console.func("pages/core/tasks/TaskPage:methods.onCancel()",arguments),this.$router.go(-1)},onCreateNote(e){console.func("pages/core/tasks/TaskPage:methods.onCreateNote()",arguments),e?(this.task.replies.splice(0,0,c.exports.cloneDeep(e)),this.default.replies.splice(0,0,c.exports.cloneDeep(e))):this.show(this.id).then(i=>{this.task=i,this.default=c.exports.cloneDeep(i)})},onUpdateArchived(){console.func("pages/core/tasks/TaskPage:methods.onUpdateArchived()",arguments),this.changeArchived(this.task).then(()=>{this.default=c.exports.cloneDeep(this.task)})}},async mounted(){this.creating?this.loaded=!0:this.show(this.id).then(e=>{this.$app.setTitle(e.subject),this.task=e,this.default=c.exports.cloneDeep(e),this.loaded=!0}).catch(e=>{this.$emit("error",e)})},computed:{edit(){return["add","edit"].includes(this.action)||this.id==="add"},creating(){return this.id==="add"},id(){return this.$route.params.id},action(){return this.$route.query.action},disable(){return this.default&&JSON.stringify(this.task)===JSON.stringify(this.default)},resetable(){return this.default&&JSON.stringify(this.task)!==JSON.stringify(this.default)},title(){return this.creating?this.$t("generalInformation"):null}}},G={class:"q-gutter-md"},K={class:"col-xs-8"},W={class:"col-xs-4"},X={class:"col-xs-12"},Y={class:"col-xs-12"},Z={class:"col-xs-12"},$={class:"col-xs-12 col-sm-12"},ee={class:"col"},se={class:"flex"},te={class:"subject text-h6"},ae={class:"created-at"},oe={class:"col-auto"},ie={class:"col-xs-12 col-sm-12"},le=["innerHTML"],ne={key:2,class:"col-xs-12"},re={class:"files"},de={class:"row q-col-gutter-sm"};function ce(e,i,u,b,s,r){const f=l("base-label"),C=l("base-input"),q=l("task-status"),U=l("base-select"),D=l("base-editor"),N=l("base-dropzone"),w=l("base-status"),P=l("base-avatar"),j=l("base-media-card"),v=l("base-section"),y=l("base-task-reply-card"),A=l("base-form"),z=l("skeleton-single-page");return n(),p(B,{padding:""},{default:d(()=>[s.loaded?(n(),p(A,{key:0,onSubmit:r.onSubmit,onCancel:r.onCancel,onReset:r.onReset,resetable:r.resetable,disable:r.disable,submited:s.submited,"no-action":!r.creating,"save-label":e.$t("send")},{default:d(()=>[a("div",G,[o(v,{flat:"",bordered:"",title:r.title,"head-class":"q-pb-sm"},{default:d(()=>[r.creating?(n(),m(g,{key:0},[a("div",K,[o(f,{required:""},{default:d(()=>[_(h(e.$t("subject")),1)]),_:1}),o(C,{modelValue:s.task.subject,"onUpdate:modelValue":i[0]||(i[0]=t=>s.task.subject=t),name:"subject"},null,8,["modelValue"])]),a("div",W,[o(f,{required:""},{default:d(()=>[_(h(e.$t("label.status")),1)]),_:1}),o(q,{modelValue:s.task.status,"onUpdate:modelValue":i[1]||(i[1]=t=>s.task.status=t),name:"status"},null,8,["modelValue"])]),a("div",X,[o(f,{required:""},{default:d(()=>[_(h(e.$t("modules.staff")),1)]),_:1}),o(U,{placeholder:e.$t("placeholder.selectStaff"),dense:"",outlined:"",modelValue:s.task.users,"onUpdate:modelValue":i[2]||(i[2]=t=>s.task.users=t),name:"users","filter-method":e.getStaff,"map-options":"","use-filter":"",multiple:"","use-chips":"","option-label":t=>`${t.name} (${t.email})`},null,8,["placeholder","modelValue","filter-method","option-label"])]),a("div",Y,[o(f,{required:""},{default:d(()=>[_(h(e.$t("message")),1)]),_:1}),o(D,{modelValue:s.task.message,"onUpdate:modelValue":i[3]||(i[3]=t=>s.task.message=t),name:"message"},null,8,["modelValue"])]),a("div",Z,[o(f,null,{default:d(()=>[_(h(e.$t("attachment")),1)]),_:1}),o(N,{modelValue:s.task.media,"onUpdate:modelValue":i[4]||(i[4]=t=>s.task.media=t),name:"media"},null,8,["modelValue"])])],64)):(n(),m(g,{key:1},[a("div",$,[a("div",{class:O({"meta-section":!0,row:e.$q.screen.gt.xs})},[a("div",ee,[a("div",se,[a("div",te,h(s.task.subject),1)]),a("div",ae,[_(h(s.task.created_at)+" ",1),o(w,{type:s.task.status},null,8,["type"])])]),a("div",oe,[a("div",{class:"relative-position",style:Q({height:"40px",width:s.task.users.length*35+"px"})},[(n(!0),m(g,null,k(s.task.users,(t,S)=>(n(),p(P,{name:"users",key:S,class:"cursor-pointer",user:t,tooltip:"",size:"40px",overlapping:S},null,8,["user","overlapping"]))),128))],4)])],2)]),a("div",ie,[a("span",{innerHTML:s.task.message},null,8,le)])],64)),!r.creating&&s.task.media.length?(n(),m("div",ne,[a("div",re,[a("div",de,[(n(!0),m(g,null,k(s.task.media,t=>(n(),m("div",{key:t.id,class:"col-sm-2 col-xs-12"},[o(j,{media:t},null,8,["media"])]))),128))])])])):V("",!0)]),_:1},8,["title"]),r.creating?V("",!0):(n(),p(v,{key:0,flat:"",bordered:"",title:e.$t("activities"),description:e.$t("tasks.activityDesc"),"no-row":"","body-class":"q-px-lg"},{default:d(()=>[o(R,{class:"comments",color:"secondary"},{default:d(()=>[o(y,{"module-id":s.task.id,class:"comment",creating:"","is-admin":"",onCreate:r.onCreateNote,archived:s.task.is_archived,"onUpdate:archived":r.onUpdateArchived},null,8,["module-id","onCreate","archived","onUpdate:archived"]),(n(!0),m(g,null,k(s.task.replies,t=>(n(),p(y,F({class:"comment",key:t.id},t,{"module-id":s.task.id,user:t.user}),null,16,["module-id","user"]))),128))]),_:1})]),_:1},8,["title","description"]))])]),_:1},8,["onSubmit","onCancel","onReset","resetable","disable","submited","no-action","save-label"])):(n(),p(z,{key:1}))]),_:1})}var ve=J(I,[["render",ce]]);export{ve as default};
