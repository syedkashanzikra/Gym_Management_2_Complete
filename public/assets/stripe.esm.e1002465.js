import{cX as C,u as f,A as a,N as M,_ as L,o as h,a as b,w as o,f as d,ac as E,K as x,I as U,n as g,e as c,t as m,af as A,d as v,F as B,ag as j,g as N,aa as Q}from"./index.46fdd451.js";import{Q as w}from"./QItemLabel.249954d1.js";import{u as R}from"./member.7e2676dd.js";const T=C("subscription",{state:()=>({isLoadingSubscription:!0,userId:void 0,user:void 0,subscription:{upcomingInvoice:null,defaultPaymentMethod:null,price:null},paymentMethods:[],invoices:[],plans:[]}),getters:{defaultPaymentMethod(e){return e.subscription.defaultPaymentMethod},upcomingInvoice(e){return e.subscription.upcomingInvoice},currentPlan(e){return e.subscription.price},noPaymentMethods(e){return(e==null?void 0:e.paymentMethods.length)<=0},selectedPlan(e){return t=>e.plans.find(r=>r.id===t)},defaultPlan(e){var n;const t=e.plans[0]||{};return{...((n=t==null?void 0:t.prices)==null?void 0:n.find(({interval:s})=>s==="month"))||{},plan:{id:t.id,label:t.label,feature_lines:t.feature_lines}}},currentUser(e){return e.user||f().user},isSubscribed(e){var t;return(t=this.currentUser)==null?void 0:t.subscribed},hasCancelled(e){var t;return(t=this.currentUser)==null?void 0:t.has_cancelled},billingDetails(){const{line1:e,line2:t,city:r,state:n,postal_code:s}=this.currentUser.address||{};return{name:this.currentUser.name,email:this.currentUser.email,phone:this.currentUser.phone_number,address:{line1:e,line2:t,city:r,state:n,postal_code:s}}},usages(e){var t,r,n;return(t=e.subscription)!=null&&t.price?(n=(r=e.subscription)==null?void 0:r.price)==null?void 0:n.features.map(s=>{var u,l;let i=(u=e.subscription)==null?void 0:u.usages.find(I=>I.slug===s.slug);return{...s,usage:(l=i==null?void 0:i.used)!=null?l:0}}):[]}},actions:{getPlans(e){return new Promise((t,r)=>{a.get("shared/plans",e).then(n=>{this.plans=n.map(s=>({...s,features:s.feature_lines,value:s.id})),t(n)}).catch(n=>{r(n)})})},subscribe(e){return new Promise((t,r)=>{e.user_id=this.userId,a.post("subscription/subscribe",e).then(n=>{t(n)}).catch(n=>{r(n)})})},getSubscribed(){return new Promise(async(e,t)=>{await this.getPlans(),a.get("subscription",{user_id:this.userId}).then(r=>{this.subscription=r,this.isLoadingSubscription=!1,e(r)}).catch(r=>{this.isLoadingSubscription=!1,t(r)})})},confirm(e){return new Promise((t,r)=>{e.user_id=this.userId,a.post("subscription/confirm",e).then(n=>{t(n)}).catch(n=>{r(n)})})},cancel(){return new Promise((e,t)=>{a.post("subscription/cancel",{user_id:this.userId}).then(async r=>{this.updateCancelled(!0),await this.getSubscribed(),e(r)}).catch(r=>{t(r)})})},cancelDowngrade(){return new Promise((e,t)=>{a.post("subscription/cancel-downgrade",{user_id:this.userId}).then(async r=>{await this.getSubscribed(),e(r)}).catch(r=>{t(r)})})},resume(){return new Promise((e,t)=>{a.post("subscription/resume",{user_id:this.userId}).then(async r=>{this.updateCancelled(!1),await this.getSubscribed(),e(r)}).catch(r=>{t(r)})})},getInvoices(e){return new Promise((t,r)=>{e.user_id=this.userId,a.post("subscription/invoices",e).then(n=>{this.invoices=n.data,t(n)}).catch(n=>{r(n)})})},downloadInvoice(e){return new Promise((t,r)=>{a.download(`subscription/invoices/${e}`,{user_id:this.userId}).then(n=>{t(n)}).catch(n=>{r(n)})})},getPaymentMethods(){return new Promise((e,t)=>{a.post("payment-methods",{user_id:this.userId}).then(r=>{this.paymentMethods=r,e(r)}).catch(r=>{t(r)})})},addPaymentMethod(e){return new Promise((t,r)=>{e.user_id=this.userId,a.post("payment-methods/store",e).then(async n=>{await this.getPaymentMethods(),t(n)}).catch(n=>{r(n)})})},updateDefaultPaymentMethod(e){return new Promise((t,r)=>{a.post(`payment-methods/${e}/update`).then(async n=>{await this.getPaymentMethods(),t(n)}).catch(n=>{r(n)})})},removePaymentMethod(e){return new Promise((t,r)=>{a.delete(`payment-methods/${e}`).then(async n=>{await this.getPaymentMethods(),t(n)}).catch(n=>{r(n)})})},async setUser(e){this.userId=e,await R().show(e).then(t=>{this.user=t})},removeUser(){this.user=null,this.userId=null,this.isLoadingSubscription=!0},updateCancelled(e){var t;(t=this.user)!=null&&t.id?this.user.has_cancelled=e:f().updateCancelled(e)}}});const D={emits:["update:current"],props:{id:[Number,String],current:[Number,String],label:String,features:{type:Array,default:()=>[]},prices:{type:Array,default:()=>[]},interval:String,isCustom:Boolean,noRadio:Boolean,dense:Boolean},methods:{onChange(){var t;if(this.noRadio)return!1;let e="create";(t=this.currentPlan)!=null&&t.id&&(e="change"),this.$emit("update:current",this.id,e)}},computed:{...M(T,["currentPlan","isSubscribed"]),price(){return this.isCustom?this.prices[0]:this.prices.find(e=>e.interval===this.interval)},isCurrent(){var e,t;return((e=this.price)==null?void 0:e.stripe_id)===((t=this.currentPlan)==null?void 0:t.stripe_id)},isSelected(){return this.current===this.id},intervalLabel(){return this.$core.priceToInterval(this.price,!1,!0)}},watch:{interval(){this.current===this.id&&this.onChange()}}},F={class:"name text-subtitle2"},V={class:"text-grey price"},k={class:"text-subtitle2"},q={class:"features"},W=["innerHTML"];function G(e,t,r,n,s,i){return h(),b(Q,{class:g({"plan-card cursor-pointer":!0,"current bg-secondary":i.isCurrent&&(!r.noRadio||!r.dense),selected:i.isSelected}),onClick:i.onChange},{default:o(()=>[d(E,null,{default:o(()=>[d(x,{class:"q-pa-none"},{default:o(()=>[d(U,null,{default:o(()=>[d(w,{class:g({flex:!r.dense})},{default:o(()=>{var u;return[c("div",F,m(r.label),1),d(A),c("div",V,[c("span",k,m(e.$core.money((u=i.price)==null?void 0:u.amount)),1),c("span",null,m(i.intervalLabel),1)])]}),_:1},8,["class"]),r.dense?N("",!0):(h(),b(w,{key:0},{default:o(()=>[c("div",q,[c("ul",null,[(h(!0),v(B,null,j(r.features,(u,l)=>(h(),v("li",{key:l},[c("span",{innerHTML:u},null,8,W)]))),128))])])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1},8,["class","onClick"])}var ee=L(D,[["render",G]]),_="https://js.stripe.com/v3",X=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,S="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",H=function(){for(var t=document.querySelectorAll('script[src^="'.concat(_,'"]')),r=0;r<t.length;r++){var n=t[r];if(!!X.test(n.src))return n}return null},z=function(t){var r=t&&!t.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(_).concat(r);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(n),n},K=function(t,r){!t||!t._registerWrapper||t._registerWrapper({name:"stripe-js",version:"1.49.0",startTime:r})},p=null,O=function(t){return p!==null||(p=new Promise(function(r,n){if(typeof window=="undefined"||typeof document=="undefined"){r(null);return}if(window.Stripe&&t&&console.warn(S),window.Stripe){r(window.Stripe);return}try{var s=H();s&&t?console.warn(S):s||(s=z(t)),s.addEventListener("load",function(){window.Stripe?r(window.Stripe):n(new Error("Stripe.js not available"))}),s.addEventListener("error",function(){n(new Error("Failed to load Stripe.js"))})}catch(i){n(i);return}})),p},$=function(t,r,n){if(t===null)return null;var s=t.apply(void 0,r);return K(s,n),s},y=Promise.resolve().then(function(){return O(null)}),P=!1;y.catch(function(e){P||console.warn(e)});var te=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];P=!0;var s=Date.now();return y.then(function(i){return $(i,r,s)})};export{ee as P,te as l,T as u};
