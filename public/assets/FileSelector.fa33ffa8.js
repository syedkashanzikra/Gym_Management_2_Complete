import{F as z,u as L,a as U,b as x,d as j,c as S,e as N}from"./FileCard.22a9b7b0.js";import{M as R,_ as P,r as h,o,a as p,w as d,d as n,t as u,g as m,k as A,f as t,F as f,h as b,e as a,ag as w,n as g,aF as C,Q as v,l as _,aD as T,ac as I,af as M,a4 as O,a7 as H,a5 as q}from"./index.46fdd451.js";import{Q as E}from"./QImg.7965eef6.js";import{Q as J}from"./QInnerLoading.1459e1ed.js";const G={components:{FileCard:z},props:{modelValue:{},relatedFiles:{type:Array,default:()=>[]},label:String,icon:{type:String,default:"fad fa-file"},hint:String,size:Number,dialogLabel:{type:String,default:"uploadMedia"},mini:Boolean,loadFromServer:Boolean,readonly:Boolean,query:{required:!1,type:[Function],default:()=>e=>({...e,rowsPerPage:7})},useControler:Boolean,inline:Boolean},data(){return{selected:this.modelValue,files:this.relatedFiles,current_page:1,last_page:1,loading:!1}},emits:["update:model-value","rejected","uploaded"],methods:{...R(L,["get"]),onRejected(e){console.func("components/FileSelector:methods.onRejected()",arguments),this.$q.notify({type:"negative",message:this.$t("fileValidation",{count:e.length})}),this.$emit("rejected",e)},onUploaded({files:e,xhr:c}){console.func("components/FileSelector:methods.onUploaded()",arguments),this.$refs.uploader.removeFile(e[0]);const l=JSON.parse(c.response);this.files.push(l),this.$emit("uploaded",l)},onLoadFile(e){console.func("components/FileSelector:methods.onLoadFile()",arguments),this.loading=!0,this.current_page=e.page,this.get(this.query(e)).then(({data:c,meta:l})=>{this.files=c,this.current_page=l.current_page,this.last_page=l.last_page,this.loading=!1}).catch(()=>{this.loading=!1})},async onFileBrowse(){if(console.func("components/FileSelector:methods.onFileBrowse()",arguments),this.readonly)return!1;this.loadFromServer&&await this.onLoadFile({page:this.current_page}),this.selected=this.modelValue,this.$refs.files.show()},onDone(){console.func("components/FileSelector:methods.onDone()",arguments),this.$emit("update:model-value",this.selected),this.$refs.files.hide()},onDetails(){console.func("components/FileSelector:methods.onDetails()",arguments),this.$q.dialog({component:U,componentProps:{file:this.selected}})},onSelect(e){console.func("components/FileSelector:methods.onSelect()",arguments),this.selected=this.selected&&this.selected.id===e.id?"":e},getSelected(e){return this.selected&&this.selected.id===e.id}},computed:{headers(){return[{name:"Authorization",value:`Bearer ${this.$app.token}`}]},url(){return"https://api.nitrofit28.coderstm.com/files/store"},disable(){return this.selected===this.modelValue},hasFile(){return this.modelValue&&typeof this.modelValue=="object"&&this.modelValue.id}},watch:{modelValue:{deep:!0,handler(e){this.selected=e}},relatedFiles:{deep:!0,handler(e){this.files=e}}}},K={key:0,class:"label text-h6"},W={class:"file-grid"},X={class:"relative-position file-box file-select-btn"},Y={class:"q-pa-xs text-black flex flex-center"},Z={class:"text-center"},$={class:"text-subtitle2 text-primary"},ee=["onClick"],le={class:"absolute-full controller"},te={class:"q-pt-xs q-pr-sm absolute-top-right"},oe={class:"q-pa-sm file-name ellipsis absolute-bottom"},se={key:0,class:"q-pa-md text-black flex flex-center"},ie={key:0,class:"thumbnail"},ne={key:1,class:"q-pa-md text-black flex flex-center file"},ae={class:"info overflow-hidden text-center"},re={key:2,class:"absolute-full q-pa-md text-black flex flex-center failed"},de={class:"info overflow-hidden text-center"},ce={class:"q-gutter-sm"},ue={class:"text-center"},me={key:0,class:"q-mt-sm"},he={key:1};function fe(e,c,l,_e,r,s){const B=h("base-info"),Q=h("base-tooltip"),y=h("file-card"),V=h("base-dialog"),D=h("base-btn");return o(),p(N,{ref:"uploader",class:g({"full-width file-selector-uploader overflow-hidden":!0,"inline-mode":l.inline}),flat:"",multiple:!1,readonly:l.readonly,"max-files":1,"field-name":"media","auto-upload":"","with-credentials":!0,headers:s.headers,url:s.url,onUploaded:s.onUploaded,onRejected:s.onRejected},{header:d(()=>[l.label?(o(),n("div",K,u(l.label),1)):m("",!0)]),list:d(F=>[A(e.$slots,"default"),t(V,{title:e.$t(l.dialogLabel),"use-separator":"","body-class":"file-selector-uploader scroll","body-style":"max-height: 50vh; min-height: 50vh",ref:"files"},{body:d(()=>[r.loading?m("",!0):(o(),n(f,{key:0},[l.hint?(o(),p(B,{key:0,class:"q-mb-md"},{default:d(()=>[b(u(l.hint),1)]),_:1})):m("",!0),a("div",W,[a("div",X,[t(x,{class:"cursor-pointer file-selector min",ratio:1},{default:d(()=>[t(j),a("div",Y,[a("div",Z,[a("div",$,u(e.$t("browseFiles")),1),a("div",null,u(e.$t("orDropFilesHereToUpload")),1)])])]),_:1})]),(o(!0),n(f,null,w(r.files,i=>(o(),n("div",{onClick:k=>s.onSelect(i),class:g({"relative-position":!0,"file-box":!0,selected:s.getSelected(i)}),key:i.id},[t(y,C({mini:l.mini},i),{default:d(()=>[a("div",le,[a("div",te,[t(v,{class:"checked-icon",size:"15px",color:"green",name:"fas fa-check-circle"})]),a("div",oe,[b(u(i.name)+" ",1),t(Q,{style:{width:"150px"}},{default:d(()=>[b(u(i.name),1)]),_:2},1024)])])]),_:2},1040,["mini"])],10,ee))),128)),(o(!0),n(f,null,w(F.files,(i,k)=>(o(),n("div",{class:"relative-position file-box",key:k},[t(x,{class:"box rounded-borders cursor-pointer bg-grey-2",ratio:1},{default:d(()=>[i.__status==="uploading"?(o(),n("div",se,[t(S,{color:"primary",size:"3rem",thickness:5})])):(o(),n(f,{key:1},[i.__img?(o(),n("div",ie,[t(E,{src:i.__img.src,contain:""},{loading:d(()=>[t(S,{color:"white"})]),_:2},1032,["src"])])):(o(),n("div",ne,[a("div",ae,[t(v,{name:`fas fa-file-${i.icon}`,size:"50px"},null,8,["name"])])])),i.__status==="failed"?(o(),n("div",re,[a("div",de,[t(_,{flat:"",round:"",color:"white",icon:"fas fa-cloud-upload-alt",onClick:F.upload},null,8,["onClick"])])])):m("",!0)],64))]),_:2},1024)]))),128))])],64)),t(J,{showing:r.loading},{default:d(()=>[t(T,{size:"50px",color:"primary"})]),_:1},8,["showing"])]),footer:d(()=>[t(I,{class:"flex"},{default:d(()=>[l.loadFromServer?(o(),n(f,{key:0},[t(_,{disable:r.current_page<=1||r.loading,onClick:c[0]||(c[0]=i=>s.onLoadFile({page:r.current_page-1>=1?r.current_page-1:1})),dense:"",round:"",flat:"",color:"primary",icon:"fal fa-angle-left"},null,8,["disable"]),t(_,{disable:r.current_page==r.last_page||r.loading,onClick:c[1]||(c[1]=i=>s.onLoadFile({page:r.current_page+1<=r.last_page?r.current_page+1:1})),dense:"",round:"",flat:"",color:"primary",icon:"fal fa-angle-right"},null,8,["disable"])],64)):m("",!0),t(M),a("div",ce,[O(t(_,{"no-caps":"",outline:"",label:e.$t("cancel"),color:"grey"},null,8,["label"]),[[H]]),t(_,{disable:s.disable,"no-caps":"",label:e.$t("done"),color:"primary",onClick:s.onDone},null,8,["disable","label","onClick"])])]),_:1})]),_:2},1032,["title"]),a("div",{class:g({"inline-mode":l.inline,"file-box":!0,mini:l.mini}),onClick:c[2]||(c[2]=q((...i)=>s.onFileBrowse&&s.onFileBrowse(...i),["stop"]))},[s.hasFile?(o(),p(y,C({key:0,"use-controler":l.useControler,onDetails:s.onDetails,onSelect:s.onFileBrowse,mini:l.mini},l.modelValue),null,16,["use-controler","onDetails","onSelect","mini"])):(o(),n("div",{key:1,class:g({"flex flex-center file-selector":!0,"inline-mode":l.inline,mini:l.mini})},[a("div",ue,[t(v,{size:l.mini?"20px":"35px",name:l.icon},null,8,["size","name"]),l.mini?m("",!0):(o(),n("div",me,[t(D,{class:"q-pl-lg q-pr-lg",color:"primary",onClick:q(s.onFileBrowse,["stop"]),outline:"",link:l.inline,"no-caps":"",label:e.$t("browseFiles")},null,8,["onClick","link","label"])])),l.mini?m("",!0):(o(),n("div",he,u(e.$t("orDropFilesHereToUpload")),1))])],2))],2)]),_:3},8,["class","readonly","headers","url","onUploaded","onRejected"])}var ye=P(G,[["render",fe]]);export{ye as F};
