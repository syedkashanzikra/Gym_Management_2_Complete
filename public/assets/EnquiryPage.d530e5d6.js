import{Q as g}from"./QItemLabel.249954d1.js";import{_ as J,aE as d,M as C,r as u,c7 as O,o,a as y,w as i,e as a,f as s,t as c,h,g as _,a4 as F,d as p,F as b,K as w,I as v,ag as A,L as H,aF as K}from"./index.46fdd451.js";import{Q as G}from"./QTimeline.b6d0ce4e.js";import{Q as W}from"./QPage.701dd41d.js";import{S as X}from"./SkeletonSinglePage.f05b1d90.js";import{u as Y}from"./enquiry.aa47bedc.js";import{u as Z}from"./member.7e2676dd.js";import{T as $}from"./EnquiryStatus.73cac8d7.js";import{P as ee}from"./ProductsCard.7a9e6958.js";import"./QSkeleton.a3e15f44.js";import"./QBadge.942c3fbf.js";import"./QTd.d26cec80.js";import"./QTable.1702d6ef.js";import"./QMarkupTable.c79e7e8d.js";import"./QSelect.37e8c679.js";import"./QField.98c52be8.js";import"./QChip.2eda5f32.js";import"./QMenu.84416a21.js";import"./selection.e9a8e664.js";import"./rtl.b51694b1.js";import"./QTr.6cbeded8.js";import"./QInnerLoading.1459e1ed.js";import"./index.dbe12f27.js";import"./tag.19d681e9.js";import"./category.8d269d68.js";import"./collection.a5cbc931.js";import"./CustomProduct.000af489.js";const E={media:[],message:"",status:"Pending",is_archived:!1,user_archived:!1},te={components:{SkeletonSinglePage:X,EnquiryStatus:$,ProductsCard:ee},data(){return{default:d.exports.cloneDeep(E),enquiry:d.exports.cloneDeep(E),loaded:!1,submited:!1}},methods:{...C(Y,["store","show","update","delete","changeArchived","changeUserArchived"]),...C(Z,{getMember:"options",getUser:"show",getUsers:"shows"}),onSubmit(t){console.func("pages/core/enquiries/EnquiryPage:methods.onSubmit()",arguments),this.submited=!0,(this.creating?this.store:this.update)({...this.enquiry,admin:this.isAdmin}).then(({data:f,message:k})=>{if(this.submited=!1,this.$q.notify(k),this.enquiry.bulk)return this.default=d.exports.cloneDeep(this.enquiry),this.$router.back(),!1;this.enquiry=f,this.default=d.exports.cloneDeep(f),this.$router.push({name:"Single Enquiry",params:{id:f.id},query:{action:"edit",title:f.subject}})}).catch(f=>{this.submited=!1,this.$core.error(f,{title:this.$t("dialog.title.error")})})},onDelete(t){console.func("pages/core/enquiries/EnquiryPage:methods.onDelete()",arguments),this.$core.confirm(this.$t("dialog.info.warning")).then(()=>{this.delete(this.id).then(()=>{this.$router.push({name:"Enquiries"})}).catch(r=>{this.$core.error(r,{title:this.$t("dialog.title.error")})})})},onReset(t){console.func("pages/core/enquiries/EnquiryPage:methods.onReset()",arguments),this.loaded=!1,this.$nextTick(()=>{this.enquiry=d.exports.cloneDeep(this.default),this.loaded=!0})},onCancel(t){console.func("pages/core/enquiries/EnquiryPage:methods.onCancel()",arguments),this.$router.go(-1)},onCreateNote(t){console.func("pages/core/enquiries/EnquiryPage:methods.onCreateNote()",arguments),t?(this.enquiry.replies.splice(0,0,d.exports.cloneDeep(t)),this.default.replies.splice(0,0,d.exports.cloneDeep(t))):this.show(this.id).then(r=>{this.enquiry=r,this.default=d.exports.cloneDeep(r)})},onUpdateArchived(){console.func("pages/core/enquiries/EnquiryPage:methods.onUpdateArchived()",arguments),(this.isAdmin?this.changeArchived:this.changeUserArchived)(this.enquiry).then(()=>{this.default=d.exports.cloneDeep(this.enquiry)})}},async mounted(){this.creating?(this.user?await this.getUser(this.user).then(t=>{this.enquiry.user={name:t.name,email:t.email,id:t.id},this.default=d.exports.cloneDeep(this.enquiry)}):this.users&&await this.getUsers({ids:this.users.split(",")}).then(t=>{this.enquiry.bulk=!0,this.enquiry.user=t.map(r=>({name:r.name,email:r.email,id:r.id})),this.default=d.exports.cloneDeep(this.enquiry)}),this.loaded=!0):this.show(this.id).then(t=>{this.$app.setTitle(t.subject||"Contact us"),this.enquiry=t,this.default=d.exports.cloneDeep(t),this.loaded=!0}).catch(t=>{this.$emit("error",t)})},computed:{edit(){return["add","edit"].includes(this.action)||this.id==="add"},creating(){return this.id==="add"},id(){return this.$route.params.id},action(){return this.$route.query.action},user(){return this.$route.query.user},users(){return this.$route.query.users},disable(){return this.default&&JSON.stringify(this.enquiry)===JSON.stringify(this.default)},guard(){return this.$route.meta.guard},isAdmin(){return this.guard==="admins"},resetable(){return this.default&&JSON.stringify(this.enquiry)!==JSON.stringify(this.default)},title(){return this.creating?this.$t("generalInformation"):this.enquiry.subject||this.$t("contactUs")}}},se={class:"q-gutter-md"},ie={class:"text-h6"},re={class:"col-xs-12"},ne={class:"col-xs-8"},oe={class:"col-xs-4"},le={class:"col-xs-12 col-sm-12"},ue={class:"col-xs-12 col-sm-12"},ae={key:1,class:"col-xs-12"},de={class:"row"},ce={key:0,class:"col-xs-12 col-sm-12"},me={key:1,class:"col-xs-12 col-sm-12"},he={class:"col-xs-12 col-sm-12"},pe=["innerHTML"],ye={key:2,class:"col-xs-12"},_e={class:"files"},fe={class:"row q-col-gutter-sm"},qe={key:0,class:"text-right"};function ge(t,r,f,k,e,n){const P=u("base-status"),q=u("base-label"),N=u("base-input"),Q=u("base-select"),T=u("enquiry-status"),j=u("base-editor"),M=u("base-dropzone"),x=u("base-avatar"),I=u("base-media-card"),V=u("base-btn"),S=u("base-section"),L=u("products-card"),D=u("base-enquiry-reply-card"),R=u("base-form"),z=u("skeleton-single-page"),B=O("guard");return o(),y(W,{padding:""},{default:i(()=>[e.loaded?(o(),y(R,{key:0,onSubmit:n.onSubmit,onCancel:n.onCancel,onReset:n.onReset,resetable:n.resetable,disable:n.disable,submited:e.submited,"no-action":!n.creating,"save-label":t.$t("send")},{default:i(()=>{var U;return[a("div",se,[s(S,{flat:"",bordered:"","head-class":"q-pb-sm"},{title:i(()=>[a("div",null,[a("div",ie,c(n.title),1),n.creating?_("",!0):(o(),y(g,{key:0},{default:i(()=>[h(c(e.enquiry.created_at)+" ",1),s(P,{type:e.enquiry.status},null,8,["type"])]),_:1}))])]),action:i(()=>[n.creating?_("",!0):F((o(),p("div",qe,[s(V,{link:"",color:"negative",icon:"fas fa-trash-can",label:t.$t("delete"),onClick:n.onDelete},null,8,["label","onClick"])])),[[B,void 0,"admins"]])]),default:i(()=>{var m;return[n.creating?(o(),p(b,{key:0},[a("div",re,[s(q,{required:""},{default:i(()=>[h(c(t.$t("subject")),1)]),_:1}),s(N,{modelValue:e.enquiry.subject,"onUpdate:modelValue":r[0]||(r[0]=l=>e.enquiry.subject=l),name:"subject"},null,8,["modelValue"])]),n.isAdmin?(o(),p(b,{key:0},[a("div",ne,[s(q,{required:""},{default:i(()=>[h(c(t.$t("user")),1)]),_:1}),s(Q,{placeholder:t.$t("placeholder.selectMember"),dense:"",outlined:"",modelValue:e.enquiry.user,"onUpdate:modelValue":r[1]||(r[1]=l=>e.enquiry.user=l),name:"user","filter-method":t.getMember,"map-options":"","use-filter":"",multiple:e.enquiry.bulk,"use-chips":e.enquiry.bulk,"option-label":l=>`${l.name} (${l.email})`},null,8,["placeholder","modelValue","filter-method","multiple","use-chips","option-label"])]),a("div",oe,[s(q,null,{default:i(()=>[h(c(t.$t("label.status")),1)]),_:1}),s(T,{modelValue:e.enquiry.status,"onUpdate:modelValue":r[2]||(r[2]=l=>e.enquiry.status=l),name:"status"},null,8,["modelValue"])])],64)):_("",!0),a("div",le,[s(q,{required:""},{default:i(()=>[h(c(t.$t("message")),1)]),_:1}),s(j,{modelValue:e.enquiry.message,"onUpdate:modelValue":r[3]||(r[3]=l=>e.enquiry.message=l),name:"message"},null,8,["modelValue"])]),a("div",ue,[s(q,null,{default:i(()=>[h(c(t.$t("attachment")),1)]),_:1}),s(M,{modelValue:e.enquiry.media,"onUpdate:modelValue":r[4]||(r[4]=l=>e.enquiry.media=l),name:"media"},null,8,["modelValue"])])],64)):(o(),p("div",ae,[a("div",de,[n.isAdmin?(o(),p("div",ce,[s(w,{class:"q-px-none"},{default:i(()=>[s(v,{avatar:""},{default:i(()=>[s(x,{size:"45px",user:n.user||{name:e.enquiry.name}},null,8,["user"])]),_:1}),s(v,null,{default:i(()=>[s(g,{class:"text-subtitle2"},{default:i(()=>[h(c(e.enquiry.name)+" - "+c(e.enquiry.email),1)]),_:1}),e.enquiry.phone?(o(),y(g,{key:0},{default:i(()=>[h(c(e.enquiry.phone),1)]),_:1})):_("",!0)]),_:1})]),_:1})])):(m=e.enquiry)!=null&&m.admin?(o(),p("div",me,[s(w,{class:"q-px-none"},{default:i(()=>[s(v,{avatar:""},{default:i(()=>[s(x,{size:"45px",user:e.enquiry.admin},null,8,["user"])]),_:1}),s(v,null,{default:i(()=>[s(g,{class:"text-subtitle2"},{default:i(()=>[h(c(e.enquiry.name),1)]),_:1}),e.enquiry.phone?(o(),y(g,{key:0},{default:i(()=>[h(c(e.enquiry.email),1)]),_:1})):_("",!0)]),_:1})]),_:1})])):_("",!0),a("div",he,[a("span",{innerHTML:e.enquiry.message},null,8,pe)])])])),!n.creating&&e.enquiry.media.length?(o(),p("div",ye,[a("div",_e,[a("div",fe,[(o(!0),p(b,null,A(e.enquiry.media,l=>(o(),p("div",{key:l.id,class:"col-sm-2 col-xs-12"},[s(I,{media:l},null,8,["media"])]))),128))])])])):_("",!0)]}),_:1}),(U=e.enquiry)!=null&&U.order?(o(),y(L,{key:0,flat:"",view:"",modelValue:e.enquiry.order.line_items,"onUpdate:modelValue":r[5]||(r[5]=m=>e.enquiry.order.line_items=m)},H({_:2},[n.isAdmin?{name:"bottom",fn:i(()=>{var m;return[s(V,{link:"",label:"View order",to:`/orders/${(m=e.enquiry)==null?void 0:m.order_id}`},null,8,["to"])]}),key:"0"}:void 0]),1032,["modelValue"])):_("",!0),n.creating?_("",!0):(o(),y(S,{key:1,flat:"",bordered:"",title:t.$t("activities"),description:t.$t("enquiries.activityDesc"),"no-row":"","body-class":"q-px-lg"},{default:i(()=>[s(G,{class:"comments",color:"secondary"},{default:i(()=>[s(D,{"module-id":e.enquiry.id,class:"comment",creating:"",onCreate:n.onCreateNote,"is-admin":n.isAdmin,archived:n.isAdmin?e.enquiry.is_archived:e.enquiry.user_archived,"onUpdate:archived":n.onUpdateArchived},null,8,["module-id","onCreate","is-admin","archived","onUpdate:archived"]),(o(!0),p(b,null,A(e.enquiry.replies,m=>(o(),y(D,K({class:"comment",key:m.id},m,{"module-id":e.enquiry.id,user:m.user}),null,16,["module-id","user"]))),128))]),_:1})]),_:1},8,["title","description"]))])]}),_:1},8,["onSubmit","onCancel","onReset","resetable","disable","submited","no-action","save-label"])):(o(),y(z,{key:1}))]),_:1})}var Ke=J(te,[["render",ge]]);export{Ke as default};
