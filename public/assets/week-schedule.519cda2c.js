import{_ as k,r as m,o as S,a as v,w as u,e as _,f as i,ac as P,af as D,a4 as C,a7 as L,aD as q,cX as O,c as r,A as n,aE as g,dz as F,dA as A}from"./index.46fdd451.js";import{u as B}from"./class-list.763448d9.js";import{u as U}from"./instructor.60bbdc9f.js";import{Q as V}from"./QInnerLoading.1459e1ed.js";const R={data(){return{selected:[],loading:!1}},props:{modelValue:{required:!1,type:Array,default:()=>[]},columns:{required:!0,type:Array,default:()=>[]},action:{required:!0,type:Function}},emits:["ok","hide"],methods:{async show(){console.func("components/ClassSelector:methods.show()",arguments),this.$refs.dialog.show()},hide(){console.func("components/ClassSelector:methods.close()",arguments),this.$refs.dialog.hide()},onDialogHide(){console.func("components/ClassSelector:methods.onDialogHide()",arguments),this.$emit("hide")},async onDone(){console.func("components/ClassSelector:methods.onDone()",arguments),await this.selected.forEach(e=>{this.action({...e,open:!0})}),this.$emit("ok",this.selected),this.hide()}},computed:{disable(){return this.selected.length<=0}}},H={class:"bordered scroll"},N={class:"q-gutter-sm"};function Q(e,t,a,l,o,c){const f=m("base-table"),s=m("base-btn"),d=m("base-dialog");return S(),v(d,{title:e.$t("registrations.bulkPrint"),class:"bulkPrint-dialog","body-class":"q-pa-none",ref:"dialog",persistent:"",onHide:c.onDialogHide,"use-separator":""},{body:u(()=>[_("div",H,[i(f,{style:{"max-height":"50vh","min-height":"50vh"},"hide-top":"",columns:a.columns,rows:a.modelValue,loaded:"","no-data-label":e.$t("registrations.noData"),"visible-columns":["day_index","start_at","end_at","class"],selection:"multiple","hide-pagination":"","rows-per-page-options":[0],ref:"registrations",selected:o.selected,"onUpdate:selected":t[0]||(t[0]=h=>o.selected=h)},null,8,["columns","rows","no-data-label","selected"])])]),footer:u(()=>[i(P,{class:"bg-white flex"},{default:u(()=>[i(D),_("div",N,[C(i(s,{"no-caps":"",outline:"",label:e.$t("cancel"),color:"grey"},null,8,["label"]),[[L]]),i(s,{disable:c.disable,"no-caps":"",icon:"fas fa-print",label:e.$t("print"),color:"primary",onClick:c.onDone},null,8,["disable","label","onClick"])])]),_:1})]),loading:u(()=>[i(V,{showing:o.loading},{default:u(()=>[i(q,{size:"50px",color:"primary"})]),_:1},8,["showing"])]),_:1},8,["title","onHide"])}var j=k(R,[["render",Q]]);const E=B(),I=U(),M=e=>[{label:e.$t("label.default"),value:"start_at"},{label:e.$t("label.class"),value:"class_id"},{label:e.$t("label.instructor"),value:"instructor_id"}],$=e=>{if(e.disable)return"";let t=0;const a=e.capacity,l=a-e.total_active_bookings,o=5-e.total_stand_by_bookings;return a&&(t=100-l/a*100),`${a}(${l})(${o}) 
`+parseFloat(t).toFixed(2)},y=e=>e.disable?"":e.has_sign_off?parseFloat((e.total_active_bookings-e.no_show)*100/e.capacity).toFixed(2):0,W=async(e,t)=>{await r.viewPdf(t,`class-schedule-${e.label}`)},z=(e,t)=>{const a=URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download=`class-schedule-${e.label}.pdf`,l.click(),setTimeout(()=>{URL.revokeObjectURL(a)},5e3)},Y=e=>{const t=URL.createObjectURL(e);A(t)},p=e=>new Promise((t,a)=>{n.download(`class-schedules/${e.id}/pdf`).then(l=>{const o=new Blob([l],{type:"application/pdf"});e.download?z(e,o):e.open?Y(o):W(e,l),t(l)}).catch(l=>{r.error(l,{title:store.$t("dialog.title.error")}),a(l)})}),w=e=>new Promise((t,a)=>{n.download("class-schedules/list-pdf",e).then(async l=>{await r.viewPdf(l,"schedules"),t(l)}).catch(l=>{a(l)})}),T=(e,t)=>{F.create({component:j,componentProps:{modelValue:t,action:p,columns:e}})},Z=O("week-schedule",{getters:{module:e=>({name:"Week Schedules",label:e.$t("modules.schedules"),singular:e.$t("modules.singular.schedule"),plural:e.$t("modules.plural.schedules")}),columns:e=>[{name:"day_index",align:"left",label:e.$t("label.day"),field:t=>t.day?`${t.day} - ${t.date_at_formated}`:"",style:"width: 40px",sortable:!0},{name:"start_at",align:"left",label:e.$t("label.time"),field:"time",style:"width: 40px",sortable:!1},{name:"class",align:"left",label:e.$t("label.className"),field:"class",format:t=>t?t.name:"",style:"width: 40px",sortable:!1},{name:"location",align:"left",label:e.$t("label.location"),field:"location",format:t=>t?t.label:"",style:"width: 40px",sortable:!1},{name:"ns",align:"center",label:e.$t("label.nS"),field:t=>t.disable?"":t.has_sign_off?t.no_show:0,style:"width: 40px",sortable:!1},{name:"at",align:"center",label:e.$t("label.at"),field:t=>y(t),style:"width: 40px",sortable:!1},{name:"capacity",align:"center",label:e.$t("label.capacity"),field:t=>$(t),style:"width: 40px",sortable:!1},{name:"instructor",align:"left",label:e.$t("label.instructor"),field:"instructor",format:t=>t?t.name:"",style:"width: 40px",sortable:!1},{name:"has_sign_off",align:"left",label:e.$t("label.signOff"),field:"has_sign_off",style:"width: 40px",format:t=>t?"Yes":"No",sortable:!1},{name:"has_remote",align:"center",label:e.$t("label.remote"),field:t=>t.disable?"":t.has_remote?"Yes":"No",style:"width: 40px",sortable:!1},{name:"cost",align:"left",label:e.$t("label.cost"),field:"cost",format:t=>r.money(t),style:"width: 40px",sortable:!1},{name:"actions",align:"right",sortable:!1}],actions:e=>[{label:e.$t("label.edit"),permission:"Edit",action:"route",route:"Single Week Schedule",params:t=>({id:t.id}),query:t=>({action:"edit"}),icon:"fas fa-edit",deleted:!1},{label:e.$t("label.print"),action:t=>p(t),icon:"fad fa-print",deleted:!1},{label:e.$t("label.pdf"),action:t=>p({...t,download:!0}),icon:"fad fa-file-pdf",deleted:!1}],toolbar:e=>[{title:e.$t("label.class"),action:"request",component:"base-select",dense:!0,outlined:!0,key:"classlist",placeholder:e.$t("placeholder.select"),optionsDense:!0,style:"width: 190px",mapOptions:!0,useFilter:!0,clearable:!0,filterMethod:E.get,optionLabel:"name",optionValue:"id",prefix:e.$t("prefix.class"),deleted:"all"},{title:e.$t("label.instructor"),action:"request",component:"base-select",dense:!0,outlined:!0,key:"instructor",placeholder:e.$t("placeholder.select"),optionsDense:!0,style:"width: 190px",mapOptions:!0,useFilter:!0,clearable:!0,filterMethod:I.get,optionLabel:"name",optionValue:"id",prefix:e.$t("prefix.instructor"),deleted:"all"},{title:e.$t("label.date"),action:"request",component:"base-date-input",dense:!0,outlined:!0,key:"date",placeholder:e.$t("placeholder.select"),style:"width: 150px",prefix:e.$t("prefix.date"),deleted:"all"},{title:e.$t("label.sort"),action:"request",component:"base-select",dense:!0,outlined:!0,key:"otherSortBy",placeholder:e.$t("placeholder.select"),optionsDense:!0,style:"width: 150px",mapOptions:!0,emitValue:!0,options:M(e),prefix:e.$t("prefix.sort"),deleted:"all"},{tooltip:e.$t("tooltip.exportAsCsv"),icon:"fas fa-file-csv",action:"export",color:"primary",deleted:"all",type:"csv"},{tooltip:e.$t("tooltip.exportAsPdf"),icon:"fas fa-file-pdf",action:({pagination:t})=>w(t),color:"primary",deleted:"all",type:"pdf"},{tooltip:e.$t("tooltip.bulkPrint"),icon:"fas fa-print",action:({columns:t,rows:a})=>T(t,a),color:"primary",deleted:"all"}],filters:e=>[]},actions:{get(e){return new Promise((t,a)=>{n.get("class-schedules",e).then(l=>{const{otherSortBy:o}=e,{data:c}=l;if(["class_id","instructor_id"].includes(o)){let f=Object.values(g.exports.groupBy(c.map(s=>({...s,class_id:s.class?s.class.id:null,instructor_id:s.instructor?s.instructor.id:null})),s=>s[o])).map(s=>{let d=g.exports.cloneDeep(s),h=d.map(b=>b.cost||0).reduce((b,x)=>parseFloat(b)+parseFloat(x),0);return d.push({id:g.exports.uniqueId("total"),class:null,instructor:null,disable:!0,cost:h}),d});this.rows=f.flatMap(s=>s)}else this.rows=c;t(l)}).catch(l=>{a(l)})})},show(e){return new Promise((t,a)=>{n.get(`class-schedules/${e}`).then(l=>{t(l)}).catch(l=>{a(l)})})},update(e){return new Promise((t,a)=>{n.put(`class-schedules/${e.id}`,e).then(l=>{t(l)}).catch(l=>{a(l)})})},changeSignOff(e){return new Promise((t,a)=>{n.post(`class-schedules/${e.id}/change-sign-off`).then(l=>{e.has_sign_off=!e.has_sign_off;const{message:o}=l;r.success(o),t(l)}).catch(l=>{r.error(l),a(l)})})},calendar(e){return new Promise((t,a)=>{n.get("class-schedules/calendar",e).then(l=>{t(l)}).catch(l=>{a(l)})})},logs(e){return new Promise((t,a)=>{n.post(`class-schedules/${e.moduleId}/logs`,e).then(l=>{t(l)}).catch(l=>{a(l)})})},calCapacity:$,calAttendance:y,listPdf:w,pdf:p}});export{Z as u};
