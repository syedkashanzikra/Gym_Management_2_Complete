import{M as Q,_ as k,r as x,o as i,a as f,L as j,ag as $,w as l,k as O,aF as T,e as o,f as t,J as I,ab as C,l as g,aE as _,h as p,t as u,ac as S,af as A,a4 as q,a7 as P,d as c,O as U,K as D,I as v,a9 as H,g as y,F as b,aI as L}from"./index.46fdd451.js";import{u as N}from"./member.7e2676dd.js";import{Q as F}from"./QMenu.84416a21.js";import{Q as E}from"./QMarkupTable.c79e7e8d.js";import{A as z}from"./CustomProduct.000af489.js";import{Q as J}from"./QPopupEdit.af630481.js";import{Q as M}from"./QSelect.37e8c679.js";import{u as R}from"./payment-method.96e05062.js";import{Q as V}from"./QItemLabel.249954d1.js";import{A as K}from"./AddressFields.58941de5.js";import{u as G}from"./location.5cd281da.js";const W=["prepend","selected","before-options","after-options","no-option"],X={props:{modelValue:{},hideNoOption:Boolean,onNewValue:Function,optionLabel:[Function,String]},emits:["update:model-value"],methods:{...Q(N,["get"]),onChange(s){console.func("components/UserSelect:methods.onChange()",arguments),this.$emit("update:model-value",s)},clear(){console.func("components/UserSelect:methods.clear()",arguments),this.$refs.user.clear()}},computed:{scopedSlots(){return Object.keys(this.$slots).filter(s=>W.includes(s))}}};function Y(s,n,h,w,e,d){const r=x("base-select");return i(),f(r,{ref:"user",placeholder:s.$t("placeholder.selectMember"),"model-value":h.modelValue,"filter-method":s.get,"map-options":"","hide-no-option":h.hideNoOption,"option-label":h.optionLabel,query:a=>({filter:a,rowsPerPage:10,option:!0,blocked:!0}),"onUpdate:modelValue":d.onChange,onNewValue:h.onNewValue},j({_:2},[$(d.scopedSlots,a=>({name:a,fn:l(m=>[O(s.$slots,a,T(m,{props:m}))])}))]),1032,["placeholder","model-value","filter-method","hide-no-option","option-label","query","onUpdate:modelValue","onNewValue"])}var Bo=k(X,[["render",Y]]);const Z={props:{modelValue:[Boolean]},emits:["update:model-value"],data(){return{collect_tax:this.modelValue}}},ee={class:"q-pa-md"},oe=o("div",{class:"q-mb-sm"},"Taxes are automatically calculated.",-1),te={class:"q-pa-md text-right"},se={class:"q-gutter-sm"};function le(s,n,h,w,e,d){return i(),f(J,{"label-set":"Save",class:"q-pa-none",style:{width:"300px","max-width":"95vw"},"content-class":"base-popup-edit",modelValue:e.collect_tax,"onUpdate:modelValue":[n[0]||(n[0]=r=>e.collect_tax=r),n[1]||(n[1]=r=>s.$emit("update:model-value",r))]},{default:l(r=>[o("div",ee,[oe,t(I,{dense:"",modelValue:r.value,"onUpdate:modelValue":a=>r.value=a,label:"Collect taxes"},null,8,["modelValue","onUpdate:modelValue"])]),t(C),o("div",te,[o("div",se,[t(g,{size:"12px",onClick:a=>r.cancel(),"no-caps":"",color:"grey",outline:"",label:"Cancel"},null,8,["onClick"]),t(g,{size:"12px",onClick:a=>r.set(),"no-caps":"",color:"positive",label:"Apply"},null,8,["onClick"])])])]),_:1},8,["modelValue"])}var ne=k(Z,[["render",le]]);const ie={emits:["ok","hide"],props:{modelValue:{required:!0,type:Object}},data(){return{order:_.exports.cloneDeep(this.modelValue),options:[],payment_method:null,payment_method_error:!1}},methods:{...Q(R,["get"]),async show(){console.func("components/order/ManualPayment:methods.show()",arguments),await this.get({manual:!0}).then(s=>{var n;this.options=s,this.payment_method=(n=s[0])==null?void 0:n.id,this.$refs.dialog.show()}).catch(s=>{this.$core.error(s,{title:"Error"})})},hide(){console.func("components/order/ManualPayment:methods.close()",arguments),this.$refs.dialog.hide()},onDialogHide(){console.func("components/order/ManualPayment:methods.onDialogHide()",arguments),this.$emit("hide")},onDone(){if(console.func("components/order/ManualPayment:methods.onDone()",arguments),!this.payment_method)return this.payment_method_error=!0,!1;this.$emit("ok",this.payment_method),this.hide()}},computed:{submit_button_label(){return this.order.id?"Mark as paid":"Create order"}}},ae={class:"row q-col-gutter-md"},de={class:"col-sm-12 col-xs-12"},re={class:""},ce={class:"col-sm-12 col-xs-12"},ue=o("div",{class:"text-label"},"Received payment method",-1),me=o("div",null," Payment method is required. Please select a received payment method. ",-1),he={class:"q-gutter-sm"};function pe(s,n,h,w,e,d){const r=x("base-dialog");return i(),f(r,{"content-style":"width: 600px; max-width: 95vw",title:"Mark as paid","body-class":"scroll",ref:"dialog",persistent:"",onHide:d.onDialogHide,"use-separator":""},{body:l(()=>[o("div",ae,[o("div",de,[o("div",re,[p(" Mark this order as paid if you received "),o("strong",null,u(s.$core.money(e.order.due_amount)),1),p(" outside. This payment won't be captured and you won't be able to refund it using app. ")])]),o("div",ce,[ue,t(M,{style:{width:"250px"},dense:"",modelValue:e.payment_method,"onUpdate:modelValue":[n[0]||(n[0]=a=>e.payment_method=a),n[1]||(n[1]=a=>e.payment_method_error=!1)],options:e.options,outlined:"","map-options":"","option-label":"name","option-value":"id","emit-value":"",error:e.payment_method_error},{error:l(()=>[me]),_:1},8,["modelValue","options","error"])])])]),footer:l(()=>[t(S,{class:"row flex"},{default:l(()=>[t(A),o("div",he,[q(t(g,{"no-caps":"",outline:"",label:"Cancel",color:"grey"},null,512),[[P]]),t(g,{"no-caps":"",label:d.submit_button_label,color:"primary",onClick:d.onDone},null,8,["label","onClick"])])]),_:1})]),_:1},8,["onHide"])}var _e=k(ie,[["render",pe]]);const fe={emits:["ok","hide"],props:{modelValue:{required:!0,type:Object}},data(){return{order:_.exports.cloneDeep(this.modelValue),invoice:{to:this.modelValue.customer.email,from:{label:'"Shoparket" <hello@shoparket.com>',email:"hello@shoparket.com"},subject:"Invoice {{label}}",message:null,order:this.modelValue.id},options:[],review:!1}},methods:{async show(){console.func("components/order/SendInvoice:methods.show()",arguments),this.options=[{label:'"Shoparket" <hello@shoparket.com>',email:"hello@shoparket.com"}],this.$refs.dialog.show()},hide(){console.func("components/order/SendInvoice:methods.close()",arguments),this.$refs.dialog.hide()},onDialogHide(){console.func("components/order/SendInvoice:methods.onDialogHide()",arguments),this.$emit("hide")},onDone(){console.func("components/order/SendInvoice:methods.onDone()",arguments),this.review?(this.$emit("ok",this.payment_method),this.hide()):this.review=!0}},computed:{submit_button_label(){return this.review?"Send invoice":"Review invoice"}}},ge={key:0,class:"row q-col-gutter-md"},ve={class:"col-sm-12 col-xs-12"},be={class:"col-sm-12 col-xs-12"},xe={key:1,class:"row q-col-gutter-md"},ye={class:"col-sm-6 col-xs-12"},ke=o("div",{class:"text-label"},"To",-1),we={class:"col-sm-6 col-xs-12"},Ve=o("div",{class:"text-label"},"From",-1),De={class:"col-sm-12 col-xs-12"},Ce=o("div",{class:"text-label"},"Subject",-1),$e={class:"col-sm-12 col-xs-12"},Se=o("div",{class:"text-label"},"Custom message (optional)",-1),qe=o("div",null,[p(" This template can be edited in "),o("a",{href:"javascript:void()"},"notifications")],-1),Pe={class:"q-gutter-sm"};function Be(s,n,h,w,e,d){const r=x("base-dialog");return i(),f(r,{"content-style":"width: 700px; max-width: 95vw",title:"Send invoice","body-class":"scroll",class:"send-invoice",ref:"dialog",persistent:"",onHide:d.onDialogHide,"use-separator":""},{body:l(()=>[e.review?(i(),c("div",ge,[o("div",ve,[t(U,{class:"bordered",dense:""},{default:l(()=>[t(D,null,{default:l(()=>[t(v,{avatar:""},{default:l(()=>[t(V,{class:"text-bold"},{default:l(()=>[p("To")]),_:1})]),_:1}),t(v,null,{default:l(()=>[t(V,{caption:""},{default:l(()=>[p(u(e.invoice.to),1)]),_:1})]),_:1})]),_:1}),t(D,null,{default:l(()=>[t(v,{avatar:""},{default:l(()=>[t(V,{class:"text-bold"},{default:l(()=>[p("From")]),_:1})]),_:1}),t(v,null,{default:l(()=>[t(V,{caption:""},{default:l(()=>[p(u(e.invoice.from.label),1)]),_:1})]),_:1})]),_:1}),t(D,null,{default:l(()=>[t(v,{avatar:""},{default:l(()=>[t(V,{class:"text-bold"},{default:l(()=>[p("Subject")]),_:1})]),_:1}),t(v,null,{default:l(()=>[t(V,{caption:""},{default:l(()=>[p(u(e.invoice.subject),1)]),_:1})]),_:1})]),_:1})]),_:1})]),o("div",be,u(e.invoice.message),1)])):(i(),c("div",xe,[o("div",ye,[ke,t(H,{dense:"",outlined:"",modelValue:e.invoice.to,"onUpdate:modelValue":n[0]||(n[0]=a=>e.invoice.to=a),type:"email"},null,8,["modelValue"])]),o("div",we,[Ve,t(M,{dense:"",modelValue:e.invoice.from,"onUpdate:modelValue":n[1]||(n[1]=a=>e.invoice.from=a),options:e.options,outlined:"","map-options":"","option-label":"label","option-value":"email"},null,8,["modelValue","options"])]),o("div",De,[Ce,t(H,{dense:"",outlined:"",modelValue:e.invoice.subject,"onUpdate:modelValue":n[2]||(n[2]=a=>e.invoice.subject=a)},null,8,["modelValue"])]),o("div",$e,[Se,t(H,{"bottom-slots":"",outlined:"",modelValue:e.invoice.message,"onUpdate:modelValue":n[3]||(n[3]=a=>e.invoice.message=a),type:"textarea"},{hint:l(()=>[qe]),_:1},8,["modelValue"])])]))]),footer:l(()=>[t(S,{class:"row flex"},{default:l(()=>[e.review?(i(),f(g,{key:0,onClick:n[4]||(n[4]=a=>e.review=!e.review),"no-caps":"",outline:"",label:"Back",color:"grey"})):y("",!0),t(A),o("div",Pe,[q(t(g,{"no-caps":"",outline:"",label:"Cancel",color:"grey"},null,512),[[P]]),t(g,{"no-caps":"",label:d.submit_button_label,color:"primary",onClick:d.onDone},null,8,["label","onClick"])])]),_:1})]),_:1},8,["onHide"])}var He=k(fe,[["render",Be]]);const Qe={components:{CollectTax:ne},props:{modelValue:{type:[Object],required:!0},view:Boolean,hasDue:Boolean,hasPayment:Boolean},emits:["update:model-value","marked-paid"],data(){return{order:_.exports.cloneDeep(this.modelValue)}},methods:{addDiscount(s){console.func("components/order/BillingDetails:methods.addDiscount()",arguments),this.$q.dialog({component:z,componentProps:{modelValue:_.exports.cloneDeep(s.discount),update:Boolean(s.discount)}}).onOk(n=>{console.func("components/order/BillingDetails:methods.addDiscount.onOk()",n),n||(s.discount_removed=!0),s.discount=n,this.$emit("update:model-value",this.order)})},addShipping(s){console.func("components/order/BillingDetails:methods.addShipping()",arguments),this.$q.dialog({component:AddShipping,componentProps:{modelValue:_.exports.cloneDeep(s.shipping_line),update:Boolean(s.shipping_line)}}).onOk(n=>{console.func("components/order/BillingDetails:methods.addShipping.onOk()",n),n||(s.shipping_line_removed=!0),s.shipping_line=n,this.$emit("update:model-value",this.order)})},onChangeTax(s){this.order.collect_tax=s,this.$emit("update:model-value",this.order)},onMarkAsPaid(){console.func("components/order/BillingDetails:methods.onMarkAsPaid()",arguments),this.$q.dialog({component:_e,componentProps:{modelValue:_.exports.cloneDeep(this.order)}}).onOk(s=>{this.$emit("marked-paid",s)})},onSendInvoice(){console.func("components/order/BillingDetails:methods.onSendInvoice()",arguments),this.$q.dialog({component:He,componentProps:{modelValue:_.exports.cloneDeep(this.order)}}).onOk(s=>{this.$emit("send-invoice",s)})}},watch:{modelValue:{deep:!0,handler(s){this.order=_.exports.cloneDeep(s)}}},computed:{canCollectPayment(){return this.hasDue&&!this.order.is_cancelled},hasTaxes(){return this.order.collect_tax&&this.order.tax_lines.length}}},Ae={class:"billing-details"},Ue=o("td",{class:"text-left"},"Subtotal",-1),Me={class:"text-left"},je={key:0},Oe={class:"text-right"},Te={class:"text-left"},Ie={key:1},Le={class:"text-left"},Ne={class:"text-right"},Fe=o("td",{class:"text-left"},"\u2014",-1),Ee={class:"text-right"},ze={class:"text-left"},Je={key:1},Re={class:"text-left"},Ke={class:"text-right"},Ge=o("td",{class:"text-left"},"Not collected",-1),We={class:"text-right"},Xe=o("td",{class:"text-left text-weight-medium"},"Total",-1),Ye=o("td",{class:"text-left"},null,-1),Ze={class:"text-right text-weight-medium"},eo={key:0},oo={colspan:"100%"},to={key:1,class:"text-primary"},so=o("td",{class:"text-left text-weight-medium"},"Paid by customer",-1),lo=o("td",{class:"text-left"},null,-1),no={class:"text-right text-weight-medium"},io={key:2,class:"text-orange-9"},ao=o("td",{class:"text-left text-weight-medium"}," Balance (customer owes you) ",-1),ro=o("td",{class:"text-left"},null,-1),co={class:"text-right text-weight-medium"},uo={class:"row flex"},mo={class:"q-gutter-md"};function ho(s,n,h,w,e,d){const r=x("base-btn"),a=x("collect-tax");return i(),c("div",Ae,[t(E,{class:"no-hover","wrap-cells":"",flat:"",dense:"",separator:"none"},{default:l(()=>[o("tbody",null,[o("tr",null,[Ue,o("td",Me,[h.view?(i(),c("div",je,u(e.order.total_products),1)):y("",!0)]),o("td",Oe,u(s.$core.money(e.order.sub_total)),1)]),o("tr",null,[o("td",Te,[h.view?(i(),c("div",Ie,"Discount")):(i(),f(r,{key:0,onClick:n[0]||(n[0]=m=>d.addDiscount(e.order)),label:e.order.discount?"Edit discount":"Add discount",link:""},null,8,["label"]))]),e.order.discount?(i(),c(b,{key:0},[o("td",Le,u(e.order.discount.description||"Custom discount"),1),o("td",Ne,"-"+u(s.$core.money(e.order.discount_total)),1)],64)):(i(),c(b,{key:1},[Fe,o("td",Ee,u(s.$core.money(0)),1)],64))]),o("tr",null,[o("td",ze,[h.view?(i(),c("div",Je,"Tax")):(i(),f(r,{key:0,label:"Tax",link:""},{default:l(()=>[t(a,{"transition-show":"jump-up","transition-hide":"jump-down",modelValue:e.order.collect_tax,"onUpdate:modelValue":[n[1]||(n[1]=m=>e.order.collect_tax=m),d.onChangeTax]},null,8,["modelValue","onUpdate:modelValue"])]),_:1}))]),d.hasTaxes?(i(),c(b,{key:0},[o("td",Re,[e.order.tax_lines.length>1?(i(),f(r,{key:0,padding:"0",label:"All tax rates",link:""},{default:l(()=>[t(F,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:l(()=>[t(U,{class:"q-pa-sm",style:{"min-width":"200px"}},{default:l(()=>[(i(!0),c(b,null,$(e.order.tax_lines,(m,B)=>(i(),f(D,{dense:"",class:"q-px-sm q-pa-none",key:B},{default:l(()=>[t(v,{avatar:""},{default:l(()=>[p(u(`${m.label} ${m.rate}%`),1)]),_:2},1024),t(v,{class:"text-right q-pa-none"},{default:l(()=>[p(u(s.$core.money(m.amount)),1)]),_:2},1024)]),_:2},1024))),128)),t(C),t(D,{dense:"",class:"q-px-sm q-pa-none"},{default:l(()=>[t(v,{class:"text-weight-bold",avatar:""},{default:l(()=>[p(" Total tax ")]),_:1}),t(v,{class:"text-right text-weight-bold q-pa-none"},{default:l(()=>[p(u(s.$core.money(e.order.tax_total)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(i(!0),c(b,{key:1},$(e.order.tax_lines,(m,B)=>(i(),c("div",{key:B},u(`${m.label} ${m.rate}%`),1))),128))]),o("td",Ke,u(s.$core.money(e.order.tax_total)),1)],64)):(i(),c(b,{key:1},[Ge,o("td",We,u(s.$core.money(e.order.tax_total)),1)],64))]),o("tr",null,[Xe,Ye,o("td",Ze,u(s.$core.money(e.order.grand_total)),1)]),h.hasPayment?(i(),c(b,{key:0},[e.order.paid_total||h.hasDue?(i(),c("tr",eo,[o("td",oo,[t(C)])])):y("",!0),e.order.paid_total?(i(),c("tr",to,[so,lo,o("td",no,u(s.$core.money(e.order.paid_total)),1)])):y("",!0),h.hasDue?(i(),c("tr",io,[ao,ro,o("td",co,u(s.$core.money(e.order.due_amount)),1)])):y("",!0)],64)):y("",!0)])]),_:1}),d.canCollectPayment?(i(),c(b,{key:0},[t(C,{class:"q-my-md"}),o("div",uo,[t(A),o("div",mo,[t(r,{onClick:d.onMarkAsPaid,icon:"fas fa-credit-card",size:"md",label:"Mark as paid"},null,8,["onClick"])])])],64)):y("",!0)])}var Ho=k(Qe,[["render",ho]]);const po={components:{AddressFields:K},props:{modelValue:{type:[Object],required:!0}},data(){return{address:_.exports.cloneDeep(this.modelValue),loading:!1}},emits:["ok","hide"],methods:{show(){console.func("components/customer/AddCustomerDialog:methods.show()",arguments),this.$refs.dialog.show()},hide(){console.func("components/customer/AddCustomerDialog:methods.close()",arguments),this.$refs.dialog.hide()},onDialogHide(){console.func("components/customer/AddCustomerDialog:methods.onDialogHide()",arguments),this.$emit("hide")},onDone(){console.func("components/customer/AddCustomerDialog:methods.onDone()",arguments),this.$emit("ok",this.address),this.hide()}},computed:{saveLabel(){return"Create"}}},_o={class:"q-gutter-sm"};function fo(s,n,h,w,e,d){const r=x("address-fields"),a=x("base-dialog");return i(),f(a,{class:"add-customer-dialog",title:"Add Customer","body-class":"scroll",ref:"dialog",persistent:"",onHide:d.onDialogHide,"use-separator":""},{body:l(()=>[t(r,{all:"",modelValue:e.address,"onUpdate:modelValue":n[0]||(n[0]=m=>e.address=m)},null,8,["modelValue"])]),footer:l(()=>[t(S,{class:"text-right"},{default:l(()=>[o("div",_o,[q(t(g,{"no-caps":"",outline:"",label:"Cancel",color:"grey"},null,512),[[P]]),t(g,{"no-caps":"",label:d.saveLabel,color:"primary",onClick:d.onDone},null,8,["label","onClick"])])]),_:1})]),_:1},8,["onHide"])}var Qo=k(po,[["render",fo]]);const go={props:{modelValue:{required:!0,type:Object,default:()=>({})}},data(){return{location:_.exports.cloneDeep(this.modelValue||{}),default:_.exports.cloneDeep(this.modelValue||{}),locations:[]}},emits:["ok","hide"],methods:{...Q(G,["get"]),async show(){console.func("components/order/ChangeLocation:methods.show()",arguments),await this.get().then(({data:s})=>{this.locations=s,this.$refs.dialog.show()}).catch(s=>{this.$core.error(s,{title:"Error"})})},hide(){console.func("components/order/ChangeLocation:methods.close()",arguments),this.$refs.dialog.hide()},onDialogHide(){console.func("components/order/ChangeLocation:methods.onDialogHide()",arguments),this.$emit("hide")},onDone(){console.func("components/order/ChangeLocation:methods.onDone()",arguments),this.$emit("ok",this.location),this.hide()}},computed:{disable(){return JSON.stringify(this.location)===JSON.stringify(this.default)}}},vo={class:"q-gutter-sm"};function bo(s,n,h,w,e,d){const r=x("base-dialog");return i(),f(r,{title:"Change location","body-class":"scroll",ref:"dialog",persistent:"",onHide:d.onDialogHide,"use-separator":""},{body:l(()=>[t(U,{class:"bordered q-gutter-sm"},{default:l(()=>[(i(!0),c(b,null,$(e.locations,a=>(i(),c("div",{key:a.id},[t(L,{size:"sm","onUpdate:modelValue":[m=>e.location=a,n[0]||(n[0]=m=>e.location.id=m)],dense:"",modelValue:e.location.id,val:a.id,label:a.name},null,8,["onUpdate:modelValue","modelValue","val","label"])]))),128))]),_:1})]),footer:l(()=>[t(S,{class:"text-right"},{default:l(()=>[o("div",vo,[q(t(g,{"no-caps":"",outline:"",label:"Cancel",color:"grey"},null,512),[[P]]),t(g,{disable:d.disable,"no-caps":"",label:"Done",color:"primary",onClick:d.onDone},null,8,["disable","onClick"])])]),_:1})]),_:1},8,["onHide"])}var Ao=k(go,[["render",bo]]);export{Qo as A,Ho as B,Ao as C,Bo as U};
