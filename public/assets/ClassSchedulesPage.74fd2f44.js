import{Q as P}from"./QToolbarTitle.cb225f03.js";import{cX as W,A as y,M as D,aE as d,_ as q,r as h,o as m,a as g,w as a,e as c,f as o,h as f,t as b,ab as V,O as R,d as x,F as Y,ag as Q,K as A,I as C,Q as N,ac as J,a4 as F,l as k,a7 as U,aD as B,dE as $}from"./index.46fdd451.js";import{Q as E}from"./QToolbar.72090c76.js";import{Q as H}from"./QPage.701dd41d.js";import{S as I}from"./SkeletonSinglePage.f05b1d90.js";import{C as L}from"./ClassSchedules.77de3ed8.js";import{Q as j}from"./QInnerLoading.1459e1ed.js";import{u as z}from"./template.90696750.js";import"./QSkeleton.a3e15f44.js";import"./QItemLabel.249954d1.js";import"./QExpansionItem.fdf07114.js";import"./class-list.763448d9.js";import"./location.aec3ed16.js";import"./instructor.60bbdc9f.js";const K=W("class-schedule",{actions:{get(e){return new Promise((t,r)=>{y.get("class-schedules/weekly",e).then(s=>{this.setRows(s.data),t(s)}).catch(s=>{r(s)})})},update(e){return new Promise((t,r)=>{y.post("class-schedules/weekly/update",e).then(s=>{t(s)}).catch(s=>{r(s)})})}}}),X=W("week-template",{actions:{get(e){return new Promise((t,r)=>{y.get("week-templates",e).then(s=>{this.setRows(s.data),t(s)}).catch(s=>{r(s)})})},update(e){return new Promise((t,r)=>{y.post("week-templates/store",e).then(s=>{t(s)}).catch(s=>{r(s)})})}}}),G={data(){return{loading:!1,year:new Date().getFullYear(),month:new Date().getMonth().toString(),months:[{label:"January",value:"0"},{label:"February",value:"1"},{label:"March",value:"2"},{label:"April",value:"3"},{label:"May",value:"4"},{label:"June",value:"5"},{label:"July",value:"6"},{label:"August",value:"7"},{label:"September",value:"8"},{label:"October",value:"9"},{label:"November",value:"10"},{label:"December",value:"11"}],default:[],weeks:[]}},emits:["ok","hide"],methods:{...D(X,["get","update"]),...D(z,{getTemplate:"get"}),show(){console.func("components/AssignScheduleTemplate:methods.show()",arguments),this.$refs.dialog.show(),this.getTemplates()},hide(){console.func("components/AssignScheduleTemplate:methods.close()",arguments),this.$refs.dialog.hide()},onDialogHide(){console.func("components/AssignScheduleTemplate:methods.onDialogHide()",arguments),this.$emit("hide")},onDone(){console.func("components/AssignScheduleTemplate:methods.onDone()",arguments),this.update({weeks:this.weeks}).then(({message:e})=>{this.$q.notify(e),this.$emit("ok"),this.hide(),this.loading=!1}).catch(e=>{this.$core.error(e,{title:this.$t("dialog.title.error")}),this.loading=!1})},getTemplates(){console.func("components/AssignScheduleTemplate:methods.getTemplates()",arguments),this.loading=!0,this.get({month:this.month,year:this.year}).then(e=>{this.weeks=e,this.default=d.exports.cloneDeep(e),this.loading=!1}).catch(()=>{this.$core.error(error,{title:this.$t("dialog.title.error")}),this.loading=!1})}},computed:{years(){return d.exports.range(this.year-2,this.year+5,1)},disable(){return JSON.stringify(this.default)===JSON.stringify(this.weeks)}}},Z={class:"row q-col-gutter-md"},ee={class:"col-sm-6 col-xs-6"},te={class:"col-sm-6 col-xs-6"},se={class:"col-xs-12"},le={class:"text-subtitle2"},oe={class:"q-gutter-sm"};function ae(e,t,r,s,l,n){const u=h("base-select"),S=h("base-info"),w=h("base-dialog");return m(),g(w,{title:e.$t("weekSchedules.dialog.title"),"body-class":"scroll","content-style":"width: 700px; max-width: 95vw",ref:"dialog",persistent:"",onHide:n.onDialogHide,"use-separator":""},{body:a(()=>[c("div",Z,[c("div",ee,[o(u,{"options-dense":"",modelValue:l.year,"onUpdate:modelValue":[t[0]||(t[0]=i=>l.year=i),n.getTemplates],options:n.years,dense:"",outlined:""},null,8,["modelValue","options","onUpdate:modelValue"])]),c("div",te,[o(u,{"options-dense":"","map-options":"",modelValue:l.month,"onUpdate:modelValue":[t[1]||(t[1]=i=>l.month=i),n.getTemplates],options:l.months,"option-label":i=>e.$t("months."+i.label),dense:"",outlined:"","emit-value":""},null,8,["modelValue","options","option-label","onUpdate:modelValue"])]),c("div",se,[o(S,null,{default:a(()=>[f(b(e.$t("weekSchedules.dialog.warning")),1)]),_:1}),o(V,{class:"q-mt-md"}),o(R,{class:"bordered"},{default:a(()=>[(m(!0),x(Y,null,Q(l.weeks,(i,v)=>(m(),g(A,{class:"q-pl-none q-pr-none",key:v},{default:a(()=>[o(C,null,{default:a(()=>[c("div",le,[o(N,{name:"fas fa-calendar",class:"q-mr-sm"}),f(" "+b(i.start_of_week_formated),1)])]),_:2},1024),o(C,null,{default:a(()=>[o(u,{placeholder:e.$t("placeholder.select"),dense:"",borderless:"",modelValue:i.template,"onUpdate:modelValue":p=>i.template=p,"filter-method":e.getTemplate,"map-options":"","use-filter":"",query:p=>({filter:p,direction:"desc",rowsPerPage:5,sortBy:"id"}),"option-label":"label","option-value":"id"},null,8,["placeholder","modelValue","onUpdate:modelValue","filter-method","query"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])])]),footer:a(()=>[o(J,{class:"text-right"},{default:a(()=>[c("div",oe,[F(o(k,{"no-caps":"",outline:"",label:e.$t("cancel"),color:"grey"},null,8,["label"]),[[U]]),o(k,{disable:n.disable,"no-caps":"",label:e.$t("update"),color:"primary",onClick:n.onDone},null,8,["disable","label","onClick"])])]),_:1})]),loading:a(()=>[o(j,{showing:l.loading},{default:a(()=>[o(B,{size:"50px",color:"primary"})]),_:1},8,["showing"])]),_:1},8,["title","onHide"])}var ne=q(G,[["render",ae]]);const{formatDate:M,subtractFromDate:re,getDayOfWeek:ie}=$,de=(e=null)=>M(re(e,{days:ie(e)-1}),"YYYY-MM-DD"),O={Monday:[],Tuesday:[],Wednesday:[],Thursday:[],Friday:[],Saturday:[],Sunday:[]},ue=e=>{let t=d.exports.groupBy(e,s=>s.day),r=d.exports.cloneDeep(O);return Object.keys(r).forEach(s=>{r[s]=t[s]||[]}),r},ce={components:{SkeletonSinglePage:I,ClassSchedules:L},data(){return{default:d.exports.cloneDeep(O),schedules:d.exports.cloneDeep(O),loaded:!1,submited:!1,startOfWeek:de(new Date),previousOfWeek:null,nextOfWeek:null,formatDate:M}},methods:{...D(K,["get","update"]),onRequest(e){console.func("pages/admins/ClassSchedulesPage:methods.onRequest()",arguments),this.loading=!0,this.get({startOfWeek:e}).then(({previousOfWeek:t,startOfWeek:r,nextOfWeek:s,data:l})=>{this.loaded=!1,this.$nextTick(()=>{const n=ue(l);this.schedules=n,this.default=d.exports.cloneDeep(n),this.loaded=!0}),this.previousOfWeek=t,this.startOfWeek=r,this.nextOfWeek=s,this.loading=!1}).catch(t=>{this.$core.error(t,{title:this.$t("dialog.title.error")})})},onSubmit(e){console.func("pages/admins/ClassSchedulesPage:methods.onSubmit()",arguments),this.submited=!0;const t=[].concat(...Object.values(d.exports.cloneDeep(this.schedules)));this.update({start_of_week:this.startOfWeek,class_schedules:t}).then(({message:r})=>{this.submited=!1,this.loaded=!1,this.$nextTick(()=>{this.default=d.exports.cloneDeep(this.schedules),this.loaded=!0}),this.$q.notify(r)}).catch(r=>{this.submited=!1,this.$core.error(r,{title:this.$t("dialog.title.error")})})},onReset(e){console.func("pages/admins/ClassSchedulesPage:methods.onReset()",arguments),this.loaded=!1,this.$nextTick(()=>{this.schedules=d.exports.cloneDeep(this.default),this.loaded=!0})},onCancel(e){console.func("pages/admins/ClassSchedulesPage:methods.onCancel()",arguments),this.$router.go(-1)},assignScheduleTemplate(){console.func("pages/admins/ClassSchedulesPage:methods.assignScheduleTemplate()",arguments),this.$q.dialog({component:ne}).onOk(e=>{this.onRequest(this.startOfWeek)})}},async mounted(){this.onRequest()},computed:{disable(){return this.default&&JSON.stringify(this.schedules)===JSON.stringify(this.default)},resetable(){return this.default&&JSON.stringify(this.schedules)!==JSON.stringify(this.default)}}},he={class:"q-gutter-md"},me={class:"q-gutter-y-xs"};function pe(e,t,r,s,l,n){const u=h("base-tooltip"),S=h("class-schedules"),w=h("base-section"),i=h("base-form"),v=h("skeleton-single-page");return m(),g(H,{padding:""},{default:a(()=>[l.loaded?(m(),g(i,{key:0,onSubmit:n.onSubmit,onCancel:n.onCancel,onReset:n.onReset,resetable:n.resetable,disable:n.disable,submited:l.submited,ref:"baseForm"},{default:a(()=>[c("div",he,[o(w,{flat:"",bordered:"",title:e.$t("classSchedules.title"),description:e.$t("classSchedules.generalDesc"),"no-row":""},{default:a(()=>[o(E,{class:"q-pa-none"},{default:a(()=>[o(P,{class:"text-body1 text-bold"},{default:a(()=>[f(" Week: "+b(l.formatDate(l.startOfWeek,"DD/MM/YYYY")),1)]),_:1}),o(k,{color:"primary",flat:"",round:"",dense:"",icon:"fas fa-calendar-lines-pen",onClick:n.assignScheduleTemplate},{default:a(()=>[o(u,null,{default:a(()=>[f("Edit/View Weeks")]),_:1})]),_:1},8,["onClick"]),o(k,{color:"primary",flat:"",round:"",dense:"",icon:"fas fa-angle-left",onClick:t[0]||(t[0]=p=>n.onRequest(l.previousOfWeek))},{default:a(()=>[o(u,null,{default:a(()=>[f(" Previous Week ("+b(l.formatDate(l.previousOfWeek,"DD/MM/YYYY"))+") ",1)]),_:1})]),_:1}),o(k,{color:"primary",flat:"",round:"",dense:"",icon:"fas fa-circle",onClick:t[1]||(t[1]=p=>n.onRequest())},{default:a(()=>[o(u,null,{default:a(()=>[f(" Current Week("+b(l.formatDate(new Date,"DD/MM/YYYY"))+") ",1)]),_:1})]),_:1}),o(k,{color:"primary",flat:"",round:"",dense:"",icon:"fas fa-angle-right",onClick:t[2]||(t[2]=p=>n.onRequest(l.nextOfWeek))},{default:a(()=>[o(u,null,{default:a(()=>[f(" Next Week ("+b(l.formatDate(l.nextOfWeek,"DD/MM/YYYY"))+") ",1)]),_:1})]),_:1})]),_:1}),c("div",me,[(m(!0),x(Y,null,Q(l.schedules,(p,_)=>(m(),g(S,{key:_,day:_,rows:l.schedules[_],"onUpdate:rows":T=>l.schedules[_]=T,group:"schedules","default-opened":_==="Monday","can-save":!n.disable,onSave:t[3]||(t[3]=T=>e.$refs.baseForm.onSave()),"start-of-week":l.startOfWeek},null,8,["day","rows","onUpdate:rows","default-opened","can-save","start-of-week"]))),128))])]),_:1},8,["title","description"])])]),_:1},8,["onSubmit","onCancel","onReset","resetable","disable","submited"])):(m(),g(v,{key:1}))]),_:1})}var qe=q(ce,[["render",pe]]);export{qe as default};
